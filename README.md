# GettingAndCleaningDataProject
## Coursera Getting and Cleaning Data Project
# below is the R script
run_analysis <- function(dirfolder){
  ##need dplyr
  direction <- "~/myR/data/"
  direction <- paste0(direction,dirfolder,"/", collapse = NULL)
  temp_path <- paste0(direction,"test/X_test.txt",collapse = NULL)
  test_data <- read.table(temp_path)
  temp_path <- paste0(direction,"train/X_train.txt",collapse = NULL)
  train_data <- read.table(temp_path)
  temp_path <- paste0(direction,"features.txt",collapse = NULL)
  feature_label <- read.table(temp_path)
  data <- rbind(test_data, train_data)
  ##print(data)
  data <- setNames(data,feature_label[,2])
  data <-tbl_df(data)
  valid_name <-make.names(names=names(data),unique=TRUE, allow_=TRUE)
  names(data)<-valid_name
  tidy_data <- select(data, contains("mean"),contains("std"))
  temp_path <- paste0(direction,"test/y_test.txt",collapse = NULL)
  act <- read.table(temp_path)
  temp_path <- paste0(direction,"train/y_train.txt",collapse = NULL)
  act2<-read.table(temp_path)
  Activity <- rbind(act,act2)
  Activity <- setNames(Activity,"Activity")
  Activity <- tbl_df(Activity)
  temp_path <- paste0(direction,"test/subject_test.txt",collapse = NULL)
  subj <- read.table(temp_path)
  temp_path <- paste0(direction,"train/subject_train.txt",collapse = NULL)
  subj2<-read.table(temp_path)
  Subject <- rbind(subj,subj2)
  Subject <- setNames(Subject,"Subject")
  Subject <- tbl_df(Subject)
  tidy_data <- cbind(Subject,Activity,tidy_data)
  tidy_data <- tbl_df(tidy_data)
  temp_path <- paste0(direction,"activity_labels.txt",collapse = NULL)
  index <- read.table(temp_path)
  index <- setNames(index, c("ind","Activity"))
  ##print(index)
  tidy_data <- merge(index,tidy_data,by.x = "ind", by.y = "Activity")
  ##View(tidy_data)
  tidy_data <- tbl_df(tidy_data)
  write.table(tidy_data, file = "tidy_data")
  Subject_group <- group_by(tidy_data,Subject)
  Activity_group <- group_by(tidy_data,Activity)
  ##View(Subject_group)
  SubGroup <- summarise_each(Subject_group,funs(mean))
  SubGroup[2:3] <- list(NULL)
  ##SubGroup <- colMeans(Subject_group[4:length(Subject_group)],na.rm = TRUE)
  ##View(SubGroup)
  write.table(SubGroup, file = "Mean_by_Subjects.txt")
  ActGroup <- summarise_each(Activity_group, funs(mean))
  ActGroup[3] <- NULL
  ActGroup <- arrange(ActGroup,ind)
  ##View(ActGroup)
  write.table(ActGroup,file = "Mean_by_Activity.txt")
  Mix_group <- group_by(tidy_data,Subject,Activity)
  MixGroup <- summarise_each(Mix_group,funs(mean))
  View(MixGroup)
  write.table(MixGroup, file = "finalreport.txt")
}
